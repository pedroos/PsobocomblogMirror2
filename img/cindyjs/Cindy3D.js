(function(){
'use strict';var q,r="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};function ba(){ba=function(){};r.Symbol||(r.Symbol=ca)}var ca=function(){var a=0;return function(b){return"jscomp_symbol_"+(b||"")+a++}}();
function t(){ba();var a=r.Symbol.iterator;a||(a=r.Symbol.iterator=r.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return da(this)}});t=function(){}}function da(a){var b=0;return ea(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function ea(a){t();a={next:a};a[r.Symbol.iterator]=function(){return this};return a}function fa(a){t();var b=a[Symbol.iterator];return b?b.call(a):da(a)}
function u(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function ha(a,b){if(b){var c=r;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}
ha("WeakMap",function(a){function b(a){this.f=(f+=Math.random()+1).toString();if(a){ba();t();a=fa(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}}function c(a){u(a,e)||aa(a,e,{value:{}})}function d(a){var b=Object[a];b&&(Object[a]=function(a){c(a);return b(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(g){return!1}}())return a;
var e="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var f=0;b.prototype.set=function(a,b){c(a);if(!u(a,e))throw Error("WeakMap key fail: "+a);a[e][this.f]=b;return this};b.prototype.get=function(a){return u(a,e)?a[e][this.f]:void 0};b.prototype.has=function(a){return u(a,e)&&u(a[e],this.f)};b.prototype.delete=function(a){return u(a,e)&&u(a[e],this.f)?delete a[e][this.f]:!1};return b});
ha("Map",function(a){function b(){var a={};return a.B=a.next=a.head=a}function c(a,b){var c=a.f;return ea(function(){if(c){for(;c.head!=a.f;)c=c.B;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})}function d(a,b){var c=b&&typeof b;"object"==c||"function"==c?f.has(b)?c=f.get(b):(c=""+ ++k,f.set(b,c)):c="p_"+b;var d=a.g[c];if(d&&u(a.g,c))for(a=0;a<d.length;a++){var n=d[a];if(b!==b&&n.key!==n.key||b===n.key)return{id:c,list:d,index:a,i:n}}return{id:c,list:d,
index:-1,i:void 0}}function e(a){this.g={};this.f=b();this.size=0;if(a){a=fa(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}}if(function(){if(!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a(fa([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||
"t"!=e.value[1]||!d.next().done?!1:!0}catch(n){return!1}}())return a;ba();t();var f=new WeakMap;e.prototype.set=function(a,b){a=0===a?0:a;var c=d(this,a);c.list||(c.list=this.g[c.id]=[]);c.i?c.i.value=b:(c.i={next:this.f,B:this.f.B,head:this.f,key:a,value:b},c.list.push(c.i),this.f.B.next=c.i,this.f.B=c.i,this.size++);return this};e.prototype.delete=function(a){a=d(this,a);return a.i&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.g[a.id],a.i.B.next=a.i.next,a.i.next.B=a.i.B,a.i.head=
null,this.size--,!0):!1};e.prototype.clear=function(){this.g={};this.f=this.f.B=b();this.size=0};e.prototype.has=function(a){return!!d(this,a).i};e.prototype.get=function(a){return(a=d(this,a).i)&&a.value};e.prototype.entries=function(){return c(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return c(this,function(a){return a.key})};e.prototype.values=function(){return c(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=
d.value,a.call(b,d[1],d[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var k=0;return e});
ha("Math.hypot",function(a){return a?a:function(a,c,d){a=Number(a);c=Number(c);var b,f=Math.max(Math.abs(a),Math.abs(c));for(b=2;b<arguments.length;b++)f=Math.max(f,Math.abs(arguments[b]));if(1E100<f||1E-100>f){if(!f)return f;a/=f;c/=f;var k=a*a+c*c;for(b=2;b<arguments.length;b++){var h=Number(arguments[b])/f;k+=h*h}return Math.sqrt(k)*f}k=a*a+c*c;for(b=2;b<arguments.length;b++)h=Number(arguments[b]),k+=h*h;return Math.sqrt(k)}});function v(a){this.message=a}v.prototype.toString=function(){return this.message};
function ia(a,b,c){this.handle=a.createProgram();a.f&&(b="#version 300 es\n"+b.replace(/attribute/g,"in").replace(/varying/g,"out"),c="#version 300 es\n"+c.replace(/varying/g,"in").replace(/gl_FragColor/g,"FragColor").replace(/texture2D/g,"texture").replace(/precision highp float;/g,"precision highp float;\n#define webgl2 true\nout vec4 FragColor;"));this.g=ja(this,a,a.VERTEX_SHADER,b);this.f=ja(this,a,a.FRAGMENT_SHADER,c);b=this.handle;a.linkProgram(b);if(!a.getProgramParameter(b,a.LINK_STATUS))throw new v("Error linking shader:\n"+
a.getProgramInfoLog(b));a.validateProgram(b);if(!a.getProgramParameter(b,a.VALIDATE_STATUS))throw new v("Error validating shader:\n"+a.getProgramInfoLog(b));var d=this.handle,e,f,k={},h;c=a.getProgramParameter(d,a.ACTIVE_UNIFORMS);for(b=0;b<c;++b){var m=a.getActiveUniform(d,b);if(null!==m&&(e=m.name.replace(/\]/g,""))){for(h=k;null!==(f=/[.\[]/.exec(e));){var g=e.substr(0,f.index);h.hasOwnProperty(g)?h=h[g]:"."===f[0]?h=h[g]={}:h=h[g]=[];e=e.substr(f.index+1)}if(1<m.size){f=m.size;var l=Array(f);
for(g=0;g<f;++g){var n=m.name+"["+g+"]";n=ka(this,a,n,m);l[g]=n}h[e]=l}else n=ka(this,a,m.name,m),h[e]=n}}this.uniform=k}function ja(a,b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);if(!b.getShaderParameter(c,b.COMPILE_STATUS))throw console.warn(d.split("\n")),new v("Error compiling shader:\n"+b.getShaderInfoLog(c));b.attachShader(a.handle,c);return c}ia.prototype.use=function(a){a.useProgram(this.handle);return this};
function la(a,b){b.detachShader(a.handle,a.g);b.deleteShader(a.g);b.detachShader(a.handle,a.f);b.deleteShader(a.f);b.deleteProgram(a.handle)}
function ka(a,b,c,d){a=b.getUniformLocation(a.handle,c);switch(d.type){case b.FLOAT:return b.uniform1fv.bind(b,a);case b.FLOAT_VEC2:return b.uniform2fv.bind(b,a);case b.FLOAT_VEC3:return b.uniform3fv.bind(b,a);case b.FLOAT_VEC4:return b.uniform4fv.bind(b,a);case b.BOOL:case b.INT:case b.SAMPLER_2D:case b.SAMPLER_CUBE:return b.uniform1iv.bind(b,a);case b.BOOL_VEC2:case b.INT_VEC2:return b.uniform2iv.bind(b,a);case b.BOOL_VEC3:case b.INT_VEC3:return b.uniform3iv.bind(b,a);case b.BOOL_VEC4:case b.INT_VEC4:return b.uniform4iv.bind(b,
a);case b.FLOAT_MAT2:return b.uniformMatrix2fv.bind(b,a,!1);case b.FLOAT_MAT3:return b.uniformMatrix3fv.bind(b,a,!1);case b.FLOAT_MAT4:return b.uniformMatrix4fv.bind(b,a,!1);default:throw new v("Unknown data type for uniform "+c);}};function ma(a){var b=a[0],c=a[1];a=a[2];var d=1/Math.sqrt(b*b+c*c+a*a);return[d*b,d*c,d*a]}function w(a){var b=1/a[3];return[b*a[0],b*a[1],b*a[2]]}function na(a,b){return[a*b[0],a*b[1],a*b[2]]}function x(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]}function oa(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}function pa(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3]]}function y(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}
function z(a,b){return[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+
a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]]}function qa(a,b,c){a=w(a);return ma(y(x(w(b),a),x(w(c),a)))};function ra(a,b){this.width=a;this.height=b;this.fieldOfView=Math.PI/360*45;this.zNear=.1;this.zFar=100;this.updatePerspective();this.setCamera([0,0,5],[0,0,0],[0,1,0])}ra.prototype.updatePerspective=function(){var a=1/Math.tan(this.fieldOfView),b=this.zNear-this.zFar;this.projectionMatrix=[a*this.height/this.width,0,0,0,0,a,0,0,0,0,(this.zFar+this.zNear)/b,-1,0,0,2*this.zFar*this.zNear/b,0]};
ra.prototype.setCamera=function(a,b,c){a=x(a,b);var d=a[0],e=a[1],f=a[2];this.viewDist=Math.sqrt(d*d+e*e+f*f);a=ma(a);c=ma(y(c,a));d=y(a,c);c=[c[0],d[0],a[0],c[1],d[1],a[1],c[2],d[2],a[2]];c=[c[4]*c[8]-c[5]*c[7],c[2]*c[7]-c[1]*c[8],c[1]*c[5]-c[2]*c[4],c[5]*c[6]-c[3]*c[8],c[0]*c[8]-c[2]*c[6],c[2]*c[3]-c[0]*c[5],c[3]*c[7]-c[4]*c[6],c[1]*c[6]-c[0]*c[7],c[0]*c[4]-c[1]*c[3]];b=[c[0]*b[0]+c[1]*b[1]+c[2]*b[2],c[3]*b[0]+c[4]*b[1]+c[5]*b[2],c[6]*b[0]+c[7]*b[1]+c[8]*b[2]];this.modelMatrix=[c[0],c[1],c[2],-b[0],
c[3],c[4],c[5],-b[1],c[6],c[7],c[8],-b[2],0,0,0,1];this.viewMatrix=[1,0,0,0,0,1,0,0,0,0,1,-this.viewDist,0,0,0,1];this.mvMatrix=z(this.viewMatrix,this.modelMatrix)};function sa(a,b,c){var d=.01*b,e=.01*c;c=Math.cos(d);b=Math.cos(e);d=Math.sin(d);e=Math.sin(e);a.modelMatrix=z(z([c,0,d,0,0,1,0,0,-d,0,c,0,0,0,0,1],[1,0,0,0,0,b,-e,0,0,e,b,0,0,0,0,1]),a.modelMatrix);a.mvMatrix=z(a.viewMatrix,a.modelMatrix)}
function ta(a,b,c){var d=.002*a.viewDist;a.modelMatrix=z([1,0,0,d*b,0,1,0,-d*c,0,0,1,0,0,0,0,1],a.modelMatrix);a.mvMatrix=z(a.viewMatrix,a.modelMatrix)}function ua(a,b){a.viewDist*=Math.pow(1.01,b);a.viewMatrix=[1,0,0,0,0,1,0,0,0,0,1,-a.viewDist,0,0,0,1];a.mvMatrix=z(a.viewMatrix,a.modelMatrix)}function va(a,b){var c=Math.cos(b);b=Math.sin(b);a.modelMatrix=z([c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1],a.modelMatrix);a.mvMatrix=z(a.viewMatrix,a.modelMatrix)};function Da(a){return{color:a,alpha:1,m:60,size:.05}}function A(a){return{color:a.color,alpha:a.alpha,m:a.m,size:a.size}};function Ea(a,b,c,d){function e(a){f.removeEventListener("webglcontextcreationerror",e,!1);a.statusMessage&&(k=a.statusMessage)}var f=document.getElementById(a);if(!f)throw new v("No canvas element with id "+a);var k="Unknown";f.addEventListener("webglcontextcreationerror",e,!1);"undefined"!==typeof CindyJS._pluginRegistry.CindyXR&&(b.xrCompatible=!0);a=null;var h=document.createElement("canvas");window.WebGL2RenderingContext&&h.getContext("webgl2")&&(a=f.getContext("webgl2",b),a.f=!0,console.log("Loaded WebGL 2.0."));
a||(h=document.createElement("canvas"),window.WebGLRenderingContext&&f.getContext("webgl")&&(a=f.getContext("webgl",b),console.log("Loaded WebGL 1.0."),/[?&]frag_depth=0/.test(window.location.search)?this.C=null:(this.C=a.getExtension("EXT_frag_depth"))||console.log("EXT_frag_depth extension not supported.")));a||(a=f.getContext("experimental-webgl",b));if(!a)throw new v("Could not obtain a WebGL context.\nReason: "+k);f.removeEventListener("webglcontextcreationerror",e,!1);a.depthFunc(a.LEQUAL);
a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);this.canvas=f;this.width=f.width;this.height=f.height;this.gl=a;this.f=1;c&&c.U&&(this.f=c.U|0,1>this.f&&(this.f=1));if(1!==this.f){b=this.width*this.height*this.f;for(c=64;c*c<b;)c*=2;this.l=this.j=c;this.D=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.D);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR);a.hint(a.GENERATE_MIPMAP_HINT,a.NICEST);a.texImage2D(a.TEXTURE_2D,
0,a.RGB,this.l,this.j,0,a.RGB,a.UNSIGNED_BYTE,null);a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null);this.V=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.V);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.l,this.j);a.bindRenderbuffer(a.RENDERBUFFER,null);this.W=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,this.W);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.D,0);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,
a.RENDERBUFFER,this.V);b=a.checkFramebufferStatus(a.FRAMEBUFFER);if(b!==a.FRAMEBUFFER_COMPLETE)throw new v("Failed to create supersampling framebuffer. glCheckFramebufferStatus returned "+b);a.bindFramebuffer(a.FRAMEBUFFER,null);this.L=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.L);a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,1,1,-1,1,0,1,1,-1,1,0,-1,-1,0,0]),a.STATIC_DRAW);this.H=new ia(a,"precision highp float;\r\n\r\nattribute vec4 aPos;\r\nvarying vec2 vPos;\r\n\r\nvoid main(){\r\nvPos=aPos.zw;\r\ngl_Position=vec4(aPos.xy,0,1);\r\n}\r\n",
"precision highp float;\r\n\r\nuniform sampler2D uTexture;\r\nvarying vec2 vPos;\r\n\r\nvoid main(){\r\ngl_FragColor=texture2D(uTexture,vPos);\r\n}\r\n");this.F=a.getAttribLocation(this.H.handle,"aPos")}else this.l=this.width,this.j=this.height;this.A=new Fa;this.J="uniform vec3 uAmbient;\r\nuniform mat4 uModelViewMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying float vShininess;\r\nvarying float vSpecularReflectiveness;\r\n\r\nvec4 gColor;\r\nvec3 gPos;\r\nvec3 gEye;\r\nvec3 gNormal;\r\nvec3 gAccumDiffuse;\r\nvec3 gAccumSpecular;\r\n\r\nvoid commonLight(in vec4 lightPos,out vec3 lightDir,\r\nout float diffuseFactor,out float specularFactor){\r\nvec3 halfVector;\r\nfloat specularDot;\r\n\r\nlightDir=normalize(lightPos.xyz-lightPos.w*gPos);\r\nhalfVector=normalize(lightDir+gEye);\r\ndiffuseFactor=max(0.0,dot(gNormal,lightDir));\r\nspecularDot=max(0.0,dot(gNormal,halfVector));\r\n\r\n\r\nif(diffuseFactor==0.0)\r\nspecularFactor=0.0;\r\nelse\r\nspecularFactor=pow(specularDot,vShininess) *vSpecularReflectiveness;\r\n}\r\n\r\nvec4 flipY(in vec4 v){\r\nreturn vec4(v.x, -v.y,v.z,v.w);\r\n}\r\n\r\nvoid pointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\r\nvec3 lightDir;\r\nfloat diffuseFactor;\r\nfloat specularFactor;\r\n\r\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\r\n\r\n\r\ngAccumDiffuse +=diffuse*diffuseFactor;\r\ngAccumSpecular+=specular*specularFactor;\r\n}\r\n\r\nvoid cameraPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\r\npointLight(flipY(lightPos),diffuse,specular);\r\n}\r\n\r\nvoid worldPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\r\npointLight(-uModelViewMatrix*lightPos,diffuse,specular);\r\n}\r\n\r\nvoid spotLight(\r\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\r\nin float spotExponent,in vec3 diffuse,in vec3 specular)\r\n{\r\nvec3 lightDir;\r\nfloat diffuseFactor;\r\nfloat specularFactor;\r\nvec3 spotDir;\r\nfloat spotCosAngle;\r\nfloat spotAttenuation;\r\n\r\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\r\n\r\nspotDir=lightPos.w*spotPos.xyz-spotPos.w*lightPos.xyz;\r\nspotCosAngle=dot(-lightDir,normalize(spotDir));\r\nspotAttenuation=\r\nstep(spotCosCutoff,spotCosAngle) *pow(spotCosAngle,spotExponent);\r\n\r\n\r\ngAccumDiffuse +=spotAttenuation*diffuse*diffuseFactor;\r\ngAccumSpecular+=spotAttenuation*specular*specularFactor;\r\n}\r\n\r\nvoid cameraSpotLight(\r\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\r\nin float spotExponent,in vec3 diffuse,in vec3 specular)\r\n{\r\nspotLight(\r\nflipY(lightPos),flipY(spotPos),\r\nspotCosCutoff,spotExponent,diffuse,specular);\r\n}\r\n\r\nvoid worldSpotLight(\r\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\r\nin float spotExponent,in vec3 diffuse,in vec3 specular)\r\n{\r\nspotLight(\r\n-uModelViewMatrix*lightPos, -uModelViewMatrix*spotPos,\r\nspotCosCutoff,spotExponent,diffuse,specular);\r\n}\r\n"+
Ga(this.A)+"\r\n\r\n\r\n\r\n\r\n\r\nvoid shade(in vec3 position,in vec3 normal){\r\n\r\ngAccumDiffuse=vec3(0.0);\r\ngAccumSpecular=vec3(0.0);\r\n\r\n\r\ngPos=position;\r\ngEye= -normalize(position);\r\ngNormal=sign(dot(gEye,normal))*normal;\r\n\r\n\r\nlightScene();\r\n\r\n\r\n\r\nvec3 color= (uAmbient+gAccumDiffuse) *gColor.xyz\r\n+gAccumSpecular;\r\n\r\ncolor=clamp(color,0.0,1.0);\r\ngl_FragColor=vec4(color.xyz,gColor.w);\r\n}\r\n";this.camera=new ra(this.width,this.height);this.spheres=new C(this);
this.cylinders=new E(this);this.triangles=new Ha(this);this.w=A(F.I);this.u=A(F.line);this.s=A(F.K);this.R=[];this.backgroundColor=[1,1,1,1];d||(d=function(a,b,c,n){a.addEventListener(b,c,!!n)});new Ia(d,this.canvas,this.camera,this)}var F={I:A(Da([1,0,0])),line:A(Da([0,0,1])),K:A(Da([0,1,0]))};Ea.prototype.clear=function(){this.spheres.clear();this.cylinders.clear();this.triangles.clear()};
Ea.prototype.v=function(){this.A.g&&(this.J="uniform vec3 uAmbient;\r\nuniform mat4 uModelViewMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying float vShininess;\r\nvarying float vSpecularReflectiveness;\r\n\r\nvec4 gColor;\r\nvec3 gPos;\r\nvec3 gEye;\r\nvec3 gNormal;\r\nvec3 gAccumDiffuse;\r\nvec3 gAccumSpecular;\r\n\r\nvoid commonLight(in vec4 lightPos,out vec3 lightDir,\r\nout float diffuseFactor,out float specularFactor){\r\nvec3 halfVector;\r\nfloat specularDot;\r\n\r\nlightDir=normalize(lightPos.xyz-lightPos.w*gPos);\r\nhalfVector=normalize(lightDir+gEye);\r\ndiffuseFactor=max(0.0,dot(gNormal,lightDir));\r\nspecularDot=max(0.0,dot(gNormal,halfVector));\r\n\r\n\r\nif(diffuseFactor==0.0)\r\nspecularFactor=0.0;\r\nelse\r\nspecularFactor=pow(specularDot,vShininess) *vSpecularReflectiveness;\r\n}\r\n\r\nvec4 flipY(in vec4 v){\r\nreturn vec4(v.x, -v.y,v.z,v.w);\r\n}\r\n\r\nvoid pointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\r\nvec3 lightDir;\r\nfloat diffuseFactor;\r\nfloat specularFactor;\r\n\r\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\r\n\r\n\r\ngAccumDiffuse +=diffuse*diffuseFactor;\r\ngAccumSpecular+=specular*specularFactor;\r\n}\r\n\r\nvoid cameraPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\r\npointLight(flipY(lightPos),diffuse,specular);\r\n}\r\n\r\nvoid worldPointLight(in vec4 lightPos,in vec3 diffuse,in vec3 specular){\r\npointLight(-uModelViewMatrix*lightPos,diffuse,specular);\r\n}\r\n\r\nvoid spotLight(\r\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\r\nin float spotExponent,in vec3 diffuse,in vec3 specular)\r\n{\r\nvec3 lightDir;\r\nfloat diffuseFactor;\r\nfloat specularFactor;\r\nvec3 spotDir;\r\nfloat spotCosAngle;\r\nfloat spotAttenuation;\r\n\r\ncommonLight(lightPos,lightDir,diffuseFactor,specularFactor);\r\n\r\nspotDir=lightPos.w*spotPos.xyz-spotPos.w*lightPos.xyz;\r\nspotCosAngle=dot(-lightDir,normalize(spotDir));\r\nspotAttenuation=\r\nstep(spotCosCutoff,spotCosAngle) *pow(spotCosAngle,spotExponent);\r\n\r\n\r\ngAccumDiffuse +=spotAttenuation*diffuse*diffuseFactor;\r\ngAccumSpecular+=spotAttenuation*specular*specularFactor;\r\n}\r\n\r\nvoid cameraSpotLight(\r\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\r\nin float spotExponent,in vec3 diffuse,in vec3 specular)\r\n{\r\nspotLight(\r\nflipY(lightPos),flipY(spotPos),\r\nspotCosCutoff,spotExponent,diffuse,specular);\r\n}\r\n\r\nvoid worldSpotLight(\r\nin vec4 lightPos,in vec4 spotPos,in float spotCosCutoff,\r\nin float spotExponent,in vec3 diffuse,in vec3 specular)\r\n{\r\nspotLight(\r\n-uModelViewMatrix*lightPos, -uModelViewMatrix*spotPos,\r\nspotCosCutoff,spotExponent,diffuse,specular);\r\n}\r\n"+Ga(this.A)+
"\r\n\r\n\r\n\r\n\r\n\r\nvoid shade(in vec3 position,in vec3 normal){\r\n\r\ngAccumDiffuse=vec3(0.0);\r\ngAccumSpecular=vec3(0.0);\r\n\r\n\r\ngPos=position;\r\ngEye= -normalize(position);\r\ngNormal=sign(dot(gEye,normal))*normal;\r\n\r\n\r\nlightScene();\r\n\r\n\r\n\r\nvec3 color= (uAmbient+gAccumDiffuse) *gColor.xyz\r\n+gAccumSpecular;\r\n\r\ncolor=clamp(color,0.0,1.0);\r\ngl_FragColor=vec4(color.xyz,gColor.w);\r\n}\r\n",Ja(this.spheres,this),Ja(this.cylinders,this),Ja(this.triangles,this));if(1===
this.f)Ka(this);else{var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.W);Ka(this);a.bindFramebuffer(a.FRAMEBUFFER,null);a.viewport(0,0,this.width,this.height);a.disable(a.DEPTH_TEST);a.bindTexture(a.TEXTURE_2D,this.D);a.generateMipmap(a.TEXTURE_2D);a.bindBuffer(a.ARRAY_BUFFER,this.L);a.enableVertexAttribArray(this.F);a.vertexAttribPointer(this.F,4,a.FLOAT,!1,16,0);this.H.use(a);this.H.uniform.uTexture([0]);a.drawArrays(a.TRIANGLE_STRIP,0,4);a.disableVertexAttribArray(this.F);a.bindTexture(a.TEXTURE_2D,
null)}this.gl.flush()};
function Ka(a){var b=a.gl,c="undefined"!==typeof CindyJS._pluginRegistry.CindyLeap,d="undefined"!==typeof CindyJS._pluginRegistry.CindyXR;d||b.viewport(0,0,a.l,a.j);b.clearColor.apply(b,a.backgroundColor);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);a.spheres.o&&a.cylinders.o&&a.triangles.o?(b.disable(b.BLEND),b.depthMask(!0),b.enable(b.DEPTH_TEST)):(b.disable(b.DEPTH_TEST),b.enable(b.BLEND),b.depthMask(!1));var e=1;c?CindyJS._pluginRegistry.CindyLeap.leapPreRender(a.camera):d&&(e=CindyJS._pluginRegistry.CindyXR.xrGetNumViews(),
CindyJS._pluginRegistry.CindyXR.xrPreRender(b,a.camera));for(var f=0;f<e;f++)d&&CindyJS._pluginRegistry.CindyXR.xrUpdateCindy3DCamera(b,f,a.camera),a.spheres.o&&a.cylinders.o&&a.triangles.o?(b.disable(b.BLEND),b.depthMask(!0),b.enable(b.DEPTH_TEST),La(a,!0)):(b.disable(b.DEPTH_TEST),b.enable(b.BLEND),b.depthMask(!1),La(a,!1),La(a,!1),b.depthMask(!0),b.enable(b.DEPTH_TEST),La(a,!1));c?CindyJS._pluginRegistry.CindyLeap.leapPostRender(a.camera):d&&CindyJS._pluginRegistry.CindyXR.xrPostRender(b,a.camera);
"undefined"!==typeof a.externalRenderHook&&a.externalRenderHook(b)}function La(a,b){b||a.spheres.v(a,1);a.triangles.v(a);a.cylinders.v(a);a.spheres.v(a,-1)}Ea.prototype.g=function(a){a.uProjectionMatrix(this.camera.projectionMatrix);var b=this.camera.mvMatrix;a.uModelViewMatrix([b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]]);b=this.A;a.uAmbient(b.P);for(var c=0;c<b.f.length;++c)b.f[c]&&Ma(b.f[c],a,c)};function Ia(a,b,c,d){this.canvas=b;this.camera=c;this.l=d;this.j=this.g=Number.NaN;this.f=!1;this.touches=new Map;a(b,"mousedown",this.Y.bind(this));a(b,"mousemove",this.$.bind(this));a(b,"mouseup",this.aa.bind(this));a(b,"mouseleave",this.Z.bind(this));a(b,"wheel",this.fa.bind(this));a(b,"touchstart",this.ea.bind(this));a(b,"touchend",this.ca.bind(this));a(b,"touchcancel",this.ba.bind(this));a(b,"touchmove",this.da.bind(this))}q=Ia.prototype;
q.Y=function(a){0===a.button&&(this.f=!0);if(void 0===a.buttons?this.f:a.buttons&1)this.g=a.clientX,this.j=a.clientY};
q.$=function(a){if(void 0===a.buttons?this.f:a.buttons&1){if(!isNaN(this.g)){var b=a.clientX-this.g,c=a.clientY-this.j;if(a.shiftKey){var d=this.camera,e=-.01*b,f=-.01*c;c=Math.cos(e);b=Math.cos(f);e=Math.sin(e);f=Math.sin(f);var k=[1,0,0,0,0,1,0,0,0,0,1,d.viewDist,0,0,0,1];d.mvMatrix=z(z([c,0,e,0,0,1,0,0,-e,0,c,0,0,0,0,1],[1,0,0,0,0,b,-f,0,0,f,b,0,0,0,0,1]),d.mvMatrix);d.modelMatrix=z(k,d.mvMatrix)}else a.altKey||a.ctrlKey||a.metaKey?ta(this.camera,b,c):sa(this.camera,b,c);this.l.v()}this.g=a.clientX;
this.j=a.clientY}};q.aa=function(a){0===a.button&&(this.f=!1)};q.Z=function(){this.f=!1;this.g=this.j=Number.NaN};q.fa=function(a){var b=a.deltaY;if(b){if(a.shiftKey)va(this.camera,-.01*b);else if(a.altKey||a.ctrlKey||a.metaKey){var c=this.camera;c.modelMatrix=z([1,0,0,0,0,1,0,0,0,0,1,-.02*c.viewDist*b,0,0,0,1],c.modelMatrix);c.mvMatrix=z(c.viewMatrix,c.modelMatrix)}else ua(this.camera,b);this.l.v()}a.preventDefault()};
q.ea=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b){var c=a[b];this.touches.set(c.identifier,{x:c.clientX,y:c.clientY})}};q.ca=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b)this.touches.delete(a[b].identifier)};q.ba=function(a){a.preventDefault();a=a.changedTouches;for(var b=0;b<a.length;++b)this.touches.delete(a[b].identifier)};
q.da=function(a){a.preventDefault();var b=a.targetTouches;if(1===b.length){var c=b[0];b=this.touches.get(c.identifier);sa(this.camera,c.clientX-b.x,c.clientY-b.y);this.l.v()}else if(2===b.length){c=b[0];var d=b[1],e=this.touches.get(c.identifier),f=this.touches.get(d.identifier),k=this.canvas.getBoundingClientRect();b=this.canvas.clientLeft+k.left+.5*this.camera.width;k=this.canvas.clientTop+k.top+.5*this.camera.height;var h=.5*(e.x+f.x+1),m=.5*(e.y+f.y+1);ta(this.camera,b-h,k-m);var g=e.x-f.x;e=
e.y-f.y;f=Math.hypot(g,e);var l=Math.atan2(e,g);h=.5*(c.clientX+d.clientX+1);m=.5*(c.clientY+d.clientY+1);g=c.clientX-d.clientX;e=c.clientY-d.clientY;c=Math.atan2(e,g);ua(this.camera,f-Math.hypot(g,e));va(this.camera,l-c);ta(this.camera,h-b,m-k);this.l.v()}b=a.changedTouches;for(a=0;a<b.length;++a)c=b[a],d=this.touches.get(c.identifier),d.x=c.clientX,d.y=c.clientY};function Fa(){this.P=[0,0,0];this.f=[new Na([0,0,0,1],[1,1,1],[1,1,1])];this.g=!1}function Oa(a,b,c){a.g=!c!==!a.f[b]||!!c&&a.f[b].type!==c.type;a.f[b]=c}function Ga(a){for(var b="",c="",d=0;d<a.f.length;++d)a.f[d]&&(b+=Pa(a.f[d],d),c+=Qa(a.f[d],d));return b+"void lightScene() {\n"+c+"}"}function G(a,b){this.type=a;this.f=b}G.prototype.g={uDiffuse:"vec3",uSpecular:"vec3",uLightPos:"vec4",uSpotPos:"vec4",uSpotCosCutoff:"float",uSpotExponent:"float"};
function Qa(a,b){return"  "+a.type+"("+a.f.map(function(a){return a+b}).join(", ")+");\n"}function Pa(a,b){return a.f.map(function(c){return"uniform "+a.g[c]+" "+c+b+";\n"}).join("")}function Ma(a,b,c){a.f.forEach(function(d){return b[d+c](a[d])})}function Na(a,b,c){this.uLightPos=a;this.uDiffuse=b;this.uSpecular=c}Na.prototype=new G("cameraPointLight",["uLightPos","uDiffuse","uSpecular"]);function Ra(a,b,c){this.uLightPos=a;this.uDiffuse=b;this.uSpecular=c}
Ra.prototype=new G("worldPointLight",["uLightPos","uDiffuse","uSpecular"]);var Sa={camera:Na,world:Ra};function Ta(a,b,c,d,e,f){this.uLightPos=a;this.uSpotPos=b;this.uSpotCosCutoff=[c];this.uSpotExponent=[d];this.uDiffuse=e;this.uSpecular=f}Ta.prototype=new G("cameraSpotLight","uLightPos uSpotPos uSpotCosCutoff uSpotExponent uDiffuse uSpecular".split(" "));function Ua(a,b,c,d,e,f){this.uLightPos=a;this.uSpotPos=b;this.uSpotCosCutoff=[c];this.uSpotExponent=[d];this.uDiffuse=e;this.uSpecular=f}
Ua.prototype=new G("worldSpotLight","uLightPos uSpotPos uSpotCosCutoff uSpotExponent uDiffuse uSpecular".split(" "));var Va={camera:Ta,world:Ua};function J(a,b){var c=a.length,d=b.length,e=Math.max.apply(null,b)+1;this.H=a;this.numAttributes=c;this.numVertices=e;this.C=b;this.numElements=d;this.itemLength=4*e*c;this.vertexByteCount=16*c;this.itemAttribByteCount=a=e*this.vertexByteCount;this.itemTotalByteCount=a+d*this.l;this.maxCount=Math.floor(65536/a)}J.prototype.l=2;
function Wa(a,b,c){a.mode=b;a.count=0;a.o=!0;a.f=16;a.data=new ArrayBuffer(16*a.itemTotalByteCount);a.dataAttribs=new Float32Array(a.data,0,16*a.itemLength);b=new Uint16Array(a.data,16*a.itemAttribByteCount);a.g=b;var d,e,f=0,k=a.C;for(d=0;16>d;++d){var h=d*a.numVertices;for(e=0;e<k.length;++e)b[f++]=k[e]+h}a.J=c.gl.createBuffer();a.L=c.gl.createBuffer();a.F=-1;a.j=null;Ja(a,c)}
function Ja(a,b){var c=b.gl;null!==a.j&&la(a.j,c);var d=["precision highp float;\nvarying float vShininess;\nvarying float vSpecularReflectiveness;",a.O].join("\n"),e=["precision highp float;",b.J,a.M].join("\n");b.C&&(e="#extension GL_EXT_frag_depth : enable\n"+e);a.j=new ia(c,d,e);var f=a.j.handle;a.D=a.H.map(function(a){return c.getAttribLocation(f,a)})}
function Xa(a,b){if(b.length!==a.itemLength)throw new v("Wrong number of attributes given");if(a.count==a.f){var c=2*a.f,d,e,f,k=a.C;c>a.maxCount&&(a.f<a.maxCount?c=a.maxCount:(a.l=4,a.itemTotalByteCount=a.itemAttribByteCount+a.numElements*a.l,a.maxCount=Math.floor(Math.pow(2,32)/a.itemAttribByteCount)));var h=new ArrayBuffer(c*a.itemTotalByteCount);var m=new Float32Array(h,0,c*a.itemLength);2===a.l?d=new Uint16Array(h,c*a.itemAttribByteCount):d=new Uint32Array(h,c*a.itemAttribByteCount);m.set(a.dataAttribs);
d.set(a.g);var g=a.g.length;for(e=a.f;e<c;++e){var l=e*a.numVertices;for(f=0;f<k.length;++f)d[g++]=k[f]+l}a.f=c;a.data=h;a.dataAttribs=m;a.g=d}a.dataAttribs.set(b,a.count++*a.itemLength)}
function ab(a,b,c){if(0!==a.count){var d=a.j,e=d.uniform;d.use(b);c(e);b.bindBuffer(b.ARRAY_BUFFER,a.J);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a.L);a.F!==a.f?(b.bufferData(b.ARRAY_BUFFER,a.dataAttribs,b.STATIC_DRAW),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.g,b.STATIC_DRAW),a.F=a.f):b.bufferSubData(b.ARRAY_BUFFER,0,new Float32Array(a.data,0,a.count*a.itemLength));for(c=0;c<a.numAttributes;++c)d=a.D[c],b.enableVertexAttribArray(d),b.vertexAttribPointer(d,4,b.FLOAT,!1,a.vertexByteCount,16*c);c=b.UNSIGNED_SHORT;
a.g instanceof Uint32Array&&(c=b.UNSIGNED_INT,b.getExtension("OES_element_index_uint"));b.drawElements(a.mode,a.numElements*a.count,c,0);for(c=0;c<a.numAttributes;++c)b.disableVertexAttribArray(a.D[c])}}J.prototype.clear=function(){this.count=0;this.o=!0};function C(a){Wa(this,a.gl.TRIANGLES,a)}C.prototype=new J(["aCenter","aColor","aRelativeShininessRadius"],[0,1,2,2,1,3]);C.prototype.O="uniform mat4 uProjectionMatrix;\r\n\r\nuniform mat4 uModelViewMatrix;\r\n\r\nattribute vec4 aCenter;\r\n\r\nattribute vec4 aColor;\r\n\r\nattribute vec4 aRelativeShininessRadius;\r\n\r\nvarying vec3 vViewSpacePos;\r\n\r\nvarying vec3 vViewSpaceCenter;\r\n\r\nvarying vec4 vColor;\r\n\r\nvarying float vRadius;\r\n\r\n\r\n\r\n\r\nvoid main(){\r\n\r\nvec4 viewPosHom=uModelViewMatrix*aCenter;\r\nvViewSpaceCenter=viewPosHom.xyz/viewPosHom.w;\r\nvec3 dir=normalize(-vViewSpaceCenter);\r\nvec3 right=normalize(cross(dir,vec3(0,1,0)));\r\nvec3 up=normalize(cross(right,dir));\r\n\r\n\r\nvColor=aColor;\r\nvShininess=aRelativeShininessRadius.z;\r\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\r\nvRadius=aRelativeShininessRadius.w;\r\n\r\n\r\nvViewSpacePos=vViewSpaceCenter+\r\nvRadius*(right*aRelativeShininessRadius.x+\r\nup*aRelativeShininessRadius.y+dir);\r\n\r\n\r\ngl_Position=uProjectionMatrix*vec4(vViewSpacePos,1);\r\n}\r\n";
C.prototype.M="uniform mat4 uProjectionMatrix;\r\n\r\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\r\n\r\nvec3 dir=normalize(ray);\r\n\r\n\r\n\r\n\r\nfloat b=dot(center,dir);\r\nfloat c=dot(center,center) -radius*radius;\r\nfloat d=b*b-c;\r\nif(d<0.0)discard;\r\nfloat lambda=b+face*sqrt(d);\r\nif(lambda<0.0)discard;\r\n\r\n\r\nreturn lambda*dir;\r\n}\r\n\r\nvoid finish(in vec3 pos,in vec3 normal){\r\nshade(pos,normal);\r\n#ifdef GL_EXT_frag_depth\r\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\r\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\r\n#endif\r\n#ifdef webgl2\r\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\r\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\r\n#endif\r\n}\r\n\n\r\nuniform float sphereMode;\r\n\r\n\r\nvarying vec3 vViewSpacePos;\r\n\r\nvarying vec3 vViewSpaceCenter;\r\n\r\nvarying float vRadius;\r\n\r\n\r\n\r\n\r\nvoid main(){\r\ngColor=vColor;\r\nvec3 pointOnSphere=\r\nsphere(vViewSpacePos,vViewSpaceCenter,vRadius,sphereMode);\r\nvec3 normal=normalize(pointOnSphere-vViewSpaceCenter);\r\nfinish(pointOnSphere,normal);\r\n}\r\n";
C.prototype.add=function(a,b,c){var d=a[0],e=a[1],f=a[2];a=a[3];var k=c.color,h=c.m,m=k[0],g=k[1];k=k[2];c=c.alpha;1>c&&(this.o=!1);Xa(this,[d,e,f,a,m,g,k,c,1,1,h,b,d,e,f,a,m,g,k,c,-1,1,h,b,d,e,f,a,m,g,k,c,1,-1,h,b,d,e,f,a,m,g,k,c,-1,-1,h,b])};C.prototype.v=function(a,b){ab(this,a.gl,function(c){a.g(c);c.sphereMode([b])})};function E(a){Wa(this,a.gl.TRIANGLE_STRIP,a)}E.prototype=new J(["aPoint1","aPoint2","aColor","aRelativeRadius","aShininess"],[0,0,2,4,6,7,2,3,1,7,5,4,1,0,2,2]);E.prototype.O="uniform mat4 uProjectionMatrix;\r\n\r\nuniform mat4 uModelViewMatrix;\r\n\r\nattribute vec4 aPoint1;\r\n\r\nattribute vec4 aPoint2;\r\n\r\nattribute vec4 aColor;\r\n\r\nattribute vec4 aRelativeRadius;\r\n\r\nattribute vec4 aShininess;\r\n\r\nvarying vec3 vPoint1;\r\n\r\nvarying vec3 vPoint2;\r\n\r\nvarying vec3 vPos;\r\n\r\nvarying vec4 vColor;\r\n\r\nvarying float vRadius;\r\n\r\n\r\n\r\n\r\nvoid main(){\r\n\r\nvec4 hom;\r\nhom=uModelViewMatrix*aPoint1;\r\nvPoint1=hom.xyz/hom.w;\r\nhom=uModelViewMatrix*aPoint2;\r\nvPoint2=hom.xyz/hom.w;\r\nvec3 dir=normalize(vPoint2-vPoint1);\r\n\r\n\r\nvec3 d2,d3;\r\nif(abs(dir.x) <abs(dir.y))\r\nd2=vec3(1,0,0);\r\nelse\r\nd2=vec3(0,1,0);\r\nd2=normalize(cross(dir,d2));\r\nd3=normalize(cross(dir,d2));\r\n\r\nvPos=aRelativeRadius.w*(mat3(dir,d2,d3)*aRelativeRadius.xyz)\r\n+0.5*((vPoint2+vPoint1) +aRelativeRadius.x*(vPoint2-vPoint1));\r\n\r\n\r\nvColor=aColor;\r\nvShininess=aShininess.x;\r\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\r\nvRadius=aRelativeRadius.w;\r\n\r\n\r\ngl_Position=uProjectionMatrix*vec4(vPos,1);\r\n}\r\n";
E.prototype.M="uniform mat4 uProjectionMatrix;\r\n\r\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\r\n\r\nvec3 dir=normalize(ray);\r\n\r\n\r\n\r\n\r\nfloat b=dot(center,dir);\r\nfloat c=dot(center,center) -radius*radius;\r\nfloat d=b*b-c;\r\nif(d<0.0)discard;\r\nfloat lambda=b+face*sqrt(d);\r\nif(lambda<0.0)discard;\r\n\r\n\r\nreturn lambda*dir;\r\n}\r\n\r\nvoid finish(in vec3 pos,in vec3 normal){\r\nshade(pos,normal);\r\n#ifdef GL_EXT_frag_depth\r\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\r\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\r\n#endif\r\n#ifdef webgl2\r\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\r\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\r\n#endif\r\n}\r\n\nvarying vec3 vPoint1;\r\n\r\nvarying vec3 vPoint2;\r\n\r\nvarying vec3 vPos;\r\n\r\nvarying float vRadius;\r\n\r\nvec3 endcaps(in float mu,inout vec3 pos){\r\nvec3 center;\r\nif(mu<0.0){\r\ncenter=vPoint1;\r\n}else if(mu>1.0){\r\ncenter=vPoint2;\r\n}else{\r\nreturn(1.0-mu)*vPoint1+mu*vPoint2;\r\n}\r\npos=sphere(vPos,center,vRadius, -1.0);\r\nreturn center;\r\n}\r\n\r\n\r\n\r\n\r\nvoid main(){\r\ngColor=vColor;\r\n\r\n\r\n\r\nvec3 ba=vPoint2-vPoint1;\r\nvec3 u=ba/dot(ba,ba);\r\nvec3 v=vPos-dot(vPos,ba)*u;\r\nvec3 w=dot(vPoint1,ba)*u-vPoint1;\r\nfloat a=dot(v,v);\r\nfloat b=2.0*dot(v,w);\r\nfloat c=dot(w,w) -vRadius*vRadius;\r\nfloat d=b*b-4.0*a*c;\r\nif(d<0.0)\r\ndiscard;\r\nfloat lambda= (b+sqrt(d))/(-2.0*a);\r\nvec3 pointOnSurface=lambda*vPos;\r\nfloat mu=dot(pointOnSurface-vPoint1,u);\r\nvec3 center=endcaps(mu,pointOnSurface);\r\nvec3 normal=normalize(pointOnSurface-center);\r\nfinish(pointOnSurface,normal);\r\n}\r\n";
E.prototype.add=function(a,b,c){var d=a[0],e=a[1],f=a[2];a=a[3];var k=b[0],h=b[1],m=b[2];b=b[3];var g=c.color,l=c.m,n=c.size,p=g[0],B=g[1];g=g[2];c=c.alpha;1>c&&(this.o=!1);Xa(this,[d,e,f,a,k,h,m,b,p,B,g,c,1,1,1,n,l,0,0,0,d,e,f,a,k,h,m,b,p,B,g,c,1,1,-1,n,l,0,0,0,d,e,f,a,k,h,m,b,p,B,g,c,1,-1,1,n,l,0,0,0,d,e,f,a,k,h,m,b,p,B,g,c,1,-1,-1,n,l,0,0,0,d,e,f,a,k,h,m,b,p,B,g,c,-1,1,1,n,l,0,0,0,d,e,f,a,k,h,m,b,p,B,g,c,-1,1,-1,n,l,0,0,0,d,e,f,a,k,h,m,b,p,B,g,c,-1,-1,1,n,l,0,0,0,d,e,f,a,k,h,m,b,p,B,g,c,-1,-1,
-1,n,l,0,0,0])};E.prototype.v=function(a){if(0!==this.count){var b=a.gl;b.enable(b.CULL_FACE);b.cullFace(b.BACK);ab(this,b,a.g.bind(a));b.disable(b.CULL_FACE)}};function Ha(a){Wa(this,a.gl.TRIANGLES,a)}Ha.prototype=new J(["aPos","aNormalAndShininess","aColor"],[0,1,2]);q=Ha.prototype;q.O="uniform mat4 uProjectionMatrix;\r\nuniform mat4 uModelViewMatrix;\r\n\r\nattribute vec4 aPos;\r\nattribute vec4 aNormalAndShininess;\r\nattribute vec4 aColor;\r\n\r\nvarying vec4 vPos;\r\nvarying vec4 vNormal;\r\nvarying vec4 vColor;\r\n\r\nvoid main(){\r\nvPos=uModelViewMatrix*aPos;\r\ngl_Position=uProjectionMatrix*vPos;\r\nvNormal=uModelViewMatrix*vec4(aNormalAndShininess.xyz,0.0);\r\nvShininess=aNormalAndShininess.w;\r\nvSpecularReflectiveness= (1.0-pow(0.95,vShininess));\r\nvColor=aColor;\r\n}\r\n";
q.M="uniform mat4 uProjectionMatrix;\r\n\r\nvec3 sphere(in vec3 ray,in vec3 center,in float radius,in float face){\r\n\r\nvec3 dir=normalize(ray);\r\n\r\n\r\n\r\n\r\nfloat b=dot(center,dir);\r\nfloat c=dot(center,center) -radius*radius;\r\nfloat d=b*b-c;\r\nif(d<0.0)discard;\r\nfloat lambda=b+face*sqrt(d);\r\nif(lambda<0.0)discard;\r\n\r\n\r\nreturn lambda*dir;\r\n}\r\n\r\nvoid finish(in vec3 pos,in vec3 normal){\r\nshade(pos,normal);\r\n#ifdef GL_EXT_frag_depth\r\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\r\ngl_FragDepthEXT= (projPoint.z/projPoint.w+1.0) /2.0;\r\n#endif\r\n#ifdef webgl2\r\nvec4 projPoint=uProjectionMatrix*vec4(pos,1);\r\ngl_FragDepth= (projPoint.z/projPoint.w+1.0) /2.0;\r\n#endif\r\n}\r\n\nvarying vec4 vPos;\r\nvarying vec4 vNormal;\r\n\r\nuniform bool uTextured;\r\nuniform sampler2D uTexture;\r\n\r\nvoid main(){\r\nif(uTextured)\r\ngColor=texture2DProj(uTexture,vColor.xyz);\r\nelse\r\ngColor=vColor;\r\nfinish(vPos.xyz/vPos.w,normalize(vNormal.xyz));\r\n}\r\n";
function K(a,b,c,d,e,f,k,h){var m=h.color,g=h.m,l=m[0],n=m[1];m=m[2];h=h.alpha;1>h&&(a.o=!1);Xa(a,[b[0],b[1],b[2],b[3],e[0],e[1],e[2],g,l,n,m,h,c[0],c[1],c[2],c[3],f[0],f[1],f[2],g,l,n,m,h,d[0],d[1],d[2],d[3],k[0],k[1],k[2],g,l,n,m,h])}function bb(a,b,c,d,e,f,k,h,m,g,l){var n=l.m;l=l.alpha;1>l&&(a.o=!1);Xa(a,[b[0],b[1],b[2],b[3],e[0],e[1],e[2],n,h[0],h[1],h[2],l,c[0],c[1],c[2],c[3],f[0],f[1],f[2],n,m[0],m[1],m[2],l,d[0],d[1],d[2],d[3],k[0],k[1],k[2],n,g[0],g[1],g[2],l])}
function cb(a,b,c){if(3==b.length){var d=b[0],e=b[1];b=b[2];var f=qa(d,e,b);K(a,d,e,b,f,f,f,c)}else{d=b.length;var k=Array(d+2);f=[0,0,0];for(e=0;e<d;++e)k[e]=w(b[e]);k[d]=k[0];k[d+1]=k[1];for(e=1;e<=d;++e)f=oa(f,y(x(k[e],k[e-1]),x(k[e],k[e+1])));if(4==d)K(a,b[0],b[1],b[3],f,f,f,c),K(a,b[3],b[1],b[2],f,f,f,c);else{k=[0,0,0,0];var h=b[d-1];for(e=0;e<d;++e)k=pa(k,b[e]);for(e=0;e<d;++e)K(a,h,b[e],k,f,f,f,c),h=b[e]}}}
function db(a,b,c,d){if(3==b.length)K(a,b[0],b[1],b[2],c[0],c[1],c[2],d);else if(4==b.length)K(a,b[0],b[1],b[3],c[0],c[1],c[3],d),K(a,b[3],b[1],b[2],c[3],c[1],c[2],d);else{var e=b.length,f,k=[0,0,0,0],h=[0,0,0];for(f=0;f<e;++f)k=pa(k,b[f]),h=oa(h,c[f]);var m=b[e-1],g=c[e-1];for(f=0;f<e;++f)K(a,m,b[f],k,g,c[f],h,d),m=b[f],g=c[f]}}q.h=null;q.N=null;q.G=null;q.S=null;q.T=null;
q.v=function(a){var b=a.gl;if(this.h){if(this.h.ready){this.h.X&&this.h.X();null===this.N&&(this.N=b.createTexture());var c=this.h.width,d=this.h.height;c=eb(c);d=eb(d);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.N);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR);b.hint(b.GENERATE_MIPMAP_HINT,
b.NICEST);if(this.h.live||this.S!==this.h||this.T!==this.h.generation){this.S=this.h;this.T=this.h.generation;var e=this.h.img;if(c!==this.h.width||d!==this.h.height)this.G||(this.G=document.createElement("canvas"),this.G.width=c,this.G.height=d),e=this.G.getContext("2d"),e.clearRect(0,0,c,d),e.drawImage(this.h.img,0,0,c,d),e=this.G;b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,e);b.generateMipmap(b.TEXTURE_2D)}ab(this,b,function(b){a.g(b);b.uTextured([!0]);b.uTexture([0])});b.bindTexture(b.TEXTURE_2D,
null)}}else ab(this,b,function(b){a.g(b);b.uTextured([!1])})};function eb(a){if(0===(a&a-1))return a;for(var b=1;b<a;)b*=2;return b};function L(a){var b=void 0===b?null:b;return"list"!==a.ctype?(console.log("argument is not a list"),b):a.value}function M(a,b,c){b=void 0===b?[0,0,0,0]:b;c=void 0===c?3:c;a=L(a);if(null===a)return b;b=a.map(N);b.length>c+1&&(console.log("Coordinate vector too long."),b=b.slice(0,c+1));for(;b.length<c;)b.push(0);b.length===c&&b.push(1);return b}
function S(a,b){b=void 0===b?[0,0,0]:b;a=L(a);if(null===a)return b;b=a.map(N);3<b.length&&(console.log("Coordinate vector too long."),b=b.slice(0,3));for(;3>b.length;)b.push(0);return b}function fb(a,b){b=void 0===b?[0,0,0,0]:b;a=S(a,b);a!==b&&(a[3]=0);return a}function T(a,b){b=void 0===b?[.5,.5,.5]:b;if("number"===a.ctype){var c=U(0,1,a);if(!isNaN(c))return[c,c,c]}a=L(a);return null===a?b:3!=a.length?(console.log("Not an RGB color vector"),b):a.map(function(a){return U(0,1,a)})}
function N(a,b){b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;a=a.value;b=a.real;0!==a.imag&&console.log("complex number is not real");return b}function V(a,b){b=void 0===b?Number.NaN:b;if("number"!==a.ctype)return console.log("argument is not a number"),b;b=a.value;a=b.real;b=b.imag;0!==b&&console.log("complex number is not real");b=Math.round(a);b!==a&&console.log("number is not an integer");return b}
function U(a,b,c,d){d=void 0===d?Number.NaN:d;c=N(c,d);return c<a?a:c>b?b:c}function W(a,b){b=void 0===b?null:b;if("string"===a.ctype)return a.value;console.log("argument is not a string");return b}function gb(a,b){var c=["camera","world"];b=void 0===b?null:b;a=W(a,b);if(a!==b&&-1!==c.indexOf(a))return a;console.log("argument is not one of "+c.join(", "));return b};var hb={};
function ib(a){function b(a,b){var c,n;for(c in a)(n=b[c])?n(m(a[c])):console.log("Modifier "+c+" not supported")}function c(a,c,d){d=void 0===d?null:d;var n=a.color,e=a.alpha,f=a.m,h=a.size;a={color:function(a){return n=T(a)},alpha:function(a){return e=U(0,1,a)},shininess:function(a){return f=U(0,128,a)},size:function(a){return h=.05*N(a)}};var l;if(d)for(l in d)a[l]=d[l];b(c,a);return{color:n,alpha:e,m:f,size:h}}function d(a){l.s.alpha=U(0,1,m(a[0]),1);return h}function e(a,b,c,d,e){for(var n=0,
f=1;f<a;++f){for(var h=1;h<b;++h)e(n,n+1,n+b+1,n+b),++n;c&&e(n,n+1-b,n+1,n+b);++n}if(d){for(a=1;a<b;++a)e(n,n+1,a,a-1),++n;c&&e(n,n+1-b,0,b-1)}}function f(a,b,c,d,f,h,g,m,k){var n=null===g?function(){return k.color}:"perface"===m?function(a){return g[a]}:function(a,b){return g[b]};e(a,b,c,d,function(a,b,c,d){var e=l.triangles;var g=[f[a],f[b],f[c],f[d]],m=[h[a],h[b],h[c],h[d]];a=[n(a,a),n(a,b),n(a,c),n(a,d)];3==g.length?e=bb(e,g[0],g[1],g[2],m[0],m[1],m[2],a[0],a[1],a[2],k):(4==g.length?(bb(e,g[0],
g[1],g[3],m[0],m[1],m[3],a[0],a[1],a[3],k),bb(e,g[3],g[1],g[2],m[3],m[1],m[2],a[3],a[1],a[2],k)):console.error("addPolygonWithNormalsAndColors not supported for more than 4 corners"),e=void 0);return e})}function k(b,d){function n(a,b){a=y(x(a,Aa),x(b,Aa));D[0]+=a[0];D[1]+=a[1];D[2]+=a[2];++Ba}var g=V(m(b[0])),k=V(m(b[1])),p=L(m(b[2])).map(function(a){return M(a)}),wa="perface",X="pervertex",O="open",P=null,xa=null,ya=null,za=c(l.s,d,{normaltype:function(a){return wa=W(a,wa).toLowerCase()},colortype:function(a){return X=
W(a,X).toLowerCase()},topology:function(a){return O=W(a,O).toLowerCase()},colors:function(a){return P=L(a).map(function(a){return T(a)})},uv:function(a){return xa=L(a).map(function(a){return M(a,[0,0,0],2)})},texture:function(b){return ya=a.getImage(b,!0)}});if(p.length!==g*k)return h;null!==ya&&null!=xa&&(l.triangles.h=ya,l.triangles.o=!1,P=xa,X="pervertex");if(null!==P&&P.length!==g*k)return h;d="closerows"===O||"closeboth"===O;var H="closecolumns"===O||"closeboth"===O,Aa=null,D=null,Ba=0;if(4===
b.length){b=L(m(b[3])).map(function(a){return S(a)});if(b.length!==g*k)return h;f(g,k,d,H,p,b,P,X,za)}else if("pervertex"===wa){b=Array(g*k);for(var Y=g*k,Z=p.map(w),Q=0,Ca=0;Q<g;++Q)for(var R=0;R<k;++R){var I=Ca+Y;Aa=Z[Ca];var Ya=Z[(I-1)%Y],Za=Z[(I+1)%Y],$a=Z[(I-k)%Y];I=Z[(I+k)%Y];D=[0,0,0];Ba=0;(H||0<Q)&&(d||0<R)&&n(Ya,$a);(H||Q+1<g)&&(d||0<R)&&n(I,Ya);(H||Q+1<g)&&(d||R+1<k)&&n(Za,I);(H||0<Q)&&(d||R+1<k)&&n($a,Za);b[Ca++]=na(4/Ba,D)}f(g,k,d,H,p,b,P,X,za)}else e(g,k,d,H,function(a,b,c,n){return cb(l.triangles,
[p[a],p[b],p[c],p[n]],za)});return h}var h=a.nada,m=a.evaluate,g=a.defineFunction,l;g("begin3d",0,function(c,d){var n="Cindy3D",e={},f={};b(d,{name:function(a){return n=W(a,n)},antialias:function(a){"boolean"===a.ctype?a=a.value:(console.log("argument is not boolean"),a=!1);return e.antialias=a},supersample:function(a){return f.U=N(a,1)}});(l=hb[n])||(hb[n]=l=new Ea(n,e,f,a.addAutoCleaningEventListener));l.clear();return h});g("end3d",0,function(){l.v();l=null;return h});g("gsave3d",0,function(){l.R.push({I:A(l.w),
line:A(l.u),K:A(l.s)});return h});g("grestore3d",0,function(){var a=l.R;0<a.length?(a=a.pop(),l.w=a.I,l.u=a.line,l.s=a.K):(l.w=A(F.I),l.u=A(F.line),l.s=A(F.K));return h});g("color3d",1,function(a){if(a=T(m(a[0]),null))l.w.color=a,l.u.color=a,l.s.color=a;return h});g("pointcolor3d",1,function(a){if(a=T(m(a[0]),null))l.w.color=a;return h});g("linecolor3d",1,function(a){if(a=T(m(a[0]),null))l.u.color=a;return h});g("surfacecolor3d",1,function(a){if(a=T(m(a[0]),null))l.s.color=a;return h});g("alpha3d",
1,d);g("surfacealpha3d",1,d);g("shininess3d",1,function(a){a=U(0,128,m(a[0]));isNaN(a)||(l.w.m=a,l.u.m=a,l.s.m=a);return h});g("pointshininess3d",1,function(a){a=U(0,128,m(a[0]));isNaN(a)||(l.w.m=a);return h});g("lineshininess3d",1,function(a){a=U(0,128,m(a[0]));isNaN(a)||(l.u.m=a);return h});g("surfaceshininess3d",1,function(a){a=U(0,128,m(a[0]));isNaN(a)||(l.s.m=a);return h});g("size3d",1,function(a){a=.05*N(m(a[0]),-1);0<=a&&(l.w.size=a,l.u.size=a);return h});g("pointsize3d",1,function(a){a=.05*
N(m(a[0]),-1);0<=a&&(l.w.size=a);return h});g("linesize3d",1,function(a){a=.05*N(m(a[0]),-1);0<=a&&(l.u.size=a);return h});g("draw3d",1,function(a,b){a=M(m(a[0]));b=c(l.w,b);l.spheres.add(a,b.size,b);return h});g("draw3d",2,function(a,b){var d=M(m(a[0]));a=M(m(a[1]));b=c(l.u,b);l.cylinders.add(d,a,b);return h});g("connect3d",1,function(a,b){a=L(m(a[0]));b=c(l.u,b);if(2>a.length)return h;for(var d=M(a[0]),e=1;e<a.length;++e){var n=M(a[e]);l.cylinders.add(d,n,b);d=n}return h});g("drawpoly3d",1,function(a,
b){a=L(m(a[0]));b=c(l.u,b);if(2>a.length)return h;for(var d=M(a[a.length-1]),e=0;e<a.length;++e){var n=M(a[e]);l.cylinders.add(d,n,b);d=n}return h});g("fillpoly3d",1,function(a,b){a=L(m(a[0]));b=c(l.s,b);if(2>a.length)return h;a=a.map(function(a){return M(a)});cb(l.triangles,a,b);return h});g("fillpoly3d",2,function(a,b){var d=L(m(a[0]));a=L(m(a[1]));b=c(l.s,b);if(2>d.length||d.length!=a.length)return h;d=d.map(function(a){return M(a)});a=a.map(function(a){return S(a)});db(l.triangles,d,a,b);return h});
g("fillcircle3d",3,function(){return h});g("drawsphere3d",2,function(a,b){var d=M(m(a[0]));a=N(m(a[1]));b=c(l.s,b);l.spheres.add(d,a,b);return h});g("mesh3d",3,function(a,b){return k(a,b)});g("mesh3d",4,function(a,b){return k(a,b)});g("triangle3d",1,function(b,d){b=L(m(b[0])).map(function(a){return M(a)});var e=null,f=null,n=null,g=null;d=c(l.s,d,{colors:function(a){return g=L(a).map(function(a){return T(a)})},uv:function(a){return e=L(a).map(function(a){return M(a,[0,0,0],2)})},texture:function(a){return f=
W(a)},normals:function(a){return n=L(a).map(function(a){return S(a)})}});if(!b||3!==b.length)return h;if(null!==f&&null!==e){var k=a.getImage(f);if(!k)return console.log("No such texture image: "+f),h;l.triangles.h=k;l.triangles.o=!1;g=e}if(null!==g&&3!==g.length||null!==n&&3!==n.length)return h;g||(g=[d.color,d.color,d.color]);n||(k=qa(b[0],b[1],b[2]),n=[k,k,k]);bb(l.triangles,b[0],b[1],b[2],n[0],n[1],n[2],g[0],g[1],g[2],d);return h});g("background3d",1,function(a){if(a=T(m(a[0]),null))a.push(1),
l.backgroundColor=a;return h});g("lookat3d",3,function(a){var b=M(m(a[0]),null),c=M(m(a[1]),null);a=S(m(a[2]),null);b&&c&&a&&l.camera.setCamera(w(b),w(c),a);return h});g("fieldofview3d",1,function(a){a=U(.01,3.13,m(a[0]),0);0<a&&(l.camera.fieldOfView=a,l.camera.updatePerspective());return h});g("depthrange3d",2,function(a){var b=N(m(a[0]),-1);a=N(m(a[1]),-1);0<=b&&a>b&&(l.camera.zNear=b,l.camera.zFar=a,l.camera.updatePerspective());return h});g("renderhints3d",0,function(){return h});g("pointlight3d",
1,function(a,c){a=V(m(a[0]),0);var d=[0,0,0,1],e=[1,1,1],f=[1,1,1],g="camera";b(c,{position:function(a){return d=M(a,d)},diffuse:function(a){return e=T(a,e)},specular:function(a){return f=T(a,f)},frame:function(a){return g=gb(a,g)}});Oa(l.A,a,new Sa[g](d,e,f));return h});g("directionallight3d",1,function(a,c){a=V(m(a[0]),0);var d=[0,-1,0,0],e=[1,1,1],f=[1,1,1],g="camera";b(c,{direction:function(a){return d=fb(a,d)},diffuse:function(a){return e=T(a,e)},specular:function(a){return f=T(a,f)},frame:function(a){return g=
gb(a,g)}});Oa(l.A,a,new Sa[g](d,e,f));return h});g("spotlight3d",1,function(a,c){a=V(m(a[0]),0);var d=[0,0,0,1],e=[0,-1,0,0],f=Math.PI/4,g=0,k=[1,1,1],n=[1,1,1],p="camera";b(c,{position:function(a){return d=M(a,d)},direction:function(a){return e=fb(a,e)},cutoffangle:function(a){return f=U(0,Math.PI,a,f)},exponent:function(a){return g=N(a,g)},diffuse:function(a){return k=T(a,k)},specular:function(a){return n=T(a,n)},frame:function(a){return p=gb(a,p)}});Oa(l.A,a,new Va[p](d,e,Math.cos(f),g,k,n));return h});
g("disablelight3d",1,function(a){a=V(m(a[0]),0);Oa(l.A,a,null);return h});g("ambientlight3d",1,function(a){if(a=T(m(a[0])))l.A.P=a;return h})}ib.instances=hb;CindyJS.registerPlugin(1,"Cindy3D",ib);
}).call(this);//# sourceMappingURL=Cindy3D.js.map

